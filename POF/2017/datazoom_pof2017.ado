program datazoom_pof2017
syntax, [trs(string)] [id(string)] [sel(string)] [std] original(string) saving(string) [english]

if "`sel'" != "" & "`id'" != "pess"{
	local trs tr6 tr7 tr8 tr9 tr10 tr11 tr12 tr13 tr14 tr15 // Apenas TRs de despesas e rendimentos
}
else if "`sel'" != "" & "`id'" == "pess"{
	local trs tr12 tr13 tr14 tr15 // Mantém somente os TRs individuais
}	
else if "`std'" != ""{
	local trs tr6 tr7 tr8 tr9 tr10 tr11 tr12 tr13 tr14 tr15 // Para std
}
else if "`trs'" == "" local trs tr1 tr2 tr3 tr4 tr5 tr6 tr7 tr8 tr9 tr10 tr11 tr12 tr13 tr14 tr15

foreach tr in `trs'{
	tempfile base_`tr' // Temps têm que ser criadas fora da função de load para serem recuperadas
	local bases `bases' `base_`tr'' // Local que armazena todas essas bases
}

load_pof17, trs(`trs') temps(`bases') original(`original') `english'

* Caso só se queira os TRs crus, acaba por aqui
if "`sel'" == "" & "`std'" == ""{
	
	cd "`saving'"

	foreach tr in `trs'{
		use `base_`tr'', clear
		save pof2017_`tr', replace
	}
}

* Caso contrário, falta aplicar a função de bases selecionadas ou a de bases padronizadas

else if "`sel'" != ""{
	pofsel_17, id(`id') sel(`sel') trs(`trs') temps(`bases') original(`original') `english'
	
	cd "`saving'"
	save pof2017_`id'_custom, replace
}
else{
	foreach type in `id'{
		pofstd_17, id(`type') trs(`trs') temps(`bases') original(`original') `english'
	
		cd "`saving'"
		save "pof2017_`type'_standard", replace
	}
}

di as result "As bases foram salvas em `saving'"

end

program load_pof17 // Armazena as bases nas temps fornecidas
syntax, temps(string) original(string) trs(string) [english]

if "`english'" != "" local lang "_en"

cd "`original'"

local registros "MORADOR DESPESA_COLETIVA CADERNETA_COLETIVA DESPESA_INDIVIDUAL ALUGUEL_ESTIMADO RENDIMENTO_TRABALHO OUTROS_RENDIMENTOS DOMICILIO INVENTARIO CARACTERISTICAS_DIETA CONSUMO_ALIMENTAR CONDICOES_VIDA RESTRICAO_PRODUTOS_SERVICOS_SAUDE SERVICO_NAO_MONETARIO_POF2 SERVICO_NAO_MONETARIO_POF4"

forvalues i = 1/`: word count `trs''{
	
	local tr: word `i' of `trs'
	local base: word `i' of `temps'
	
	local num = substr("`tr'", 3, .) // tr1 -> 1, tr11 -> 11
	local registro: word `num' of `registros'
	
	di as input "Extraindo TR`num': `registro'"
	
	tempfile dic

	findfile dict.dta

	read_compdct, compdct("`r(fn)'") dict_name("pof2017_`tr'`lang'") out("`dic'")
	
	qui infile using `dic', using("`original'/`registro'.txt") clear
	
	qui save `base', replace // Salva o TR na tempfile destinada a ele
}

end

program pofsel_17
syntax, id(string) sel(string) trs(string) temps(string) original(string) [english]

/* Criando locais para cada item de consumo e seu código */

* Alimentação (arquivo Tradutor_Alimentação)

local Alface 67001 67078
local Arroz 63001 63002 63003 63018 63033 63034 63052 63053 63054
local Azeite_de_oliva 84001
local Açúcar_cristal 69002 69087
local Açúcar_refinado 69001 69086
local Banana 68001 68002 68003 68004 68005 68006 68007 68008 68009 68010 68011 68091 68098 68104
local Batata_inglesa 64001 64018
local Bebidas_não_alcoólicas_light_e_diet 69128 82007 82008 82015 82016 82019 82040 82052 82074 82075 82076 82077 82078 82079 82081 82082 82083 82084 82085 82087 82088 82089 82090 82091 82092 82093 82094 82095 82096 82097 82098 82099 82100 82110 82111 82112 82113 82114 82115 82116 82117 82118 82119 82120 82121 82122 82123 82124 82125 82126 82127 82128 82129 82134 82139 82140 82141 82145 82150 82152 82156 83044
local Biscoito 80022 80023 80024 80048 80049 80052 80053 80054 80118 80125 80128 80139 80140 80141
local Café_moído 82025 82106
local Carne_de_boi_de_primeira 71001 71002 71003 71004 71005 71006 71007 71014 71016 71059 71064 71078 71113 71114 71115 71116 71117 71118 71119 71120 71125 71126 71127 71128 71133
local Carne_de_boi_de_segunda 71008 71009 71010 71011 71012 71013 71015 71017 71026 71108 71112 71122
local Carne_de_suíno 71033 71034 71035 71036 71037 71038 71039 71040 71041 71042 71044 71045 71046 71047 71048 71049 71050 71051 71052 71053 71060 71065 71068 71070 71075 71082 71083 71084 71085 71097 71105 71106 71121 71130 71134 71136 71138 71139 71144 71145 71146 71148
local Carnes_e_peixes_industrializados 72004 72005 72014 72015 72024 72025 72034 72035 72044 72045 72054 72055 72064 72065 72074 72075 72084 72085 72094 72095 72104 72105 72114 72115 72116 72124 72125 72134 72135 72144 72145 72154 72155 72164 72165 72174 72175 72184 72185 72194 72195 72204 72205 72214 72215 72224 72225 72234 72235 72244 72245 72254 72255 72264 72265 72274 72275 72284 72285 72294 72295 72304 72305 72314 72315 72324 72325 72334 72335 72344 72345 72354 72355 72364 72365 72374 72375 72384 72385 72394 72395 72404 72405 72414 72415 72424 72425 72434 72435 72444 72445 72454 72455 72464 72465 72474 72475 72484 72485 72494 72495 72504 72505 72514 72515 72524 72525 72534 72535 72544 72545 72554 72555 72564 72565 72574 72575 72584 72585 72594 72595 72604 72606 72614 72624 72634 72644 72664 72674 72684 72694 72695 72704 72714 72715 72724 72725 72734 72744 72754 72755 72805 74004 74005 74014 74015 74024 74025 74034 74035 74044 74045 74054 74055 74064 74065 74074 74075 74084 74085 74094 74095 74104 74105 74114 74115 74124 74125 74134 74135 74144 74145 74154 74155 74164 74165 74174 74175 74184 74185 74194 74195 74204 74205 74214 74215 74224 74225 74234 74235 74244 74245 74254 74255 74264 74265 74274 74275 74284 74285 74294 74295 74304 74305 74314 74315 74324 74325 74334 74335 74344 74345 74354 74355 74364 74365 74374 74375 74384 74385 74394 74395 74404 74405 74414 74415 74424 74425 74434 74444 74445 74454 74455 74464 74465 74474 74475 74484 74485 74494 74495 74504 74514 74515 76004 76005 81001 81002 81003 81004 81005 81006 81007 81008 81009 81010 81012 81013 81014 81015 81016 81017 81018 81019 81020 81021 81022 81023 81024 81025 81026 81027 81029 81031 81036 81039 81042 81043 81044 81045 81046 81047 81048 81050 81052 81053 81054 81057 81062 81063 81064 81065 81066 81067 81068 81070 81071 81072 81073 81074 81078 81080 81082 81083
local Cebola 67057 67130
local Cenoura 64012 64019
local Cervejas_e_chopes 83001 83002 83033 83043 83050 83051
local Farinha_de_mandioca 65014
local Farinha_de_trigo 65010
local Feijao 63050 63056
local Feijão 63012 63013 63014 63015 63016 63017 63019 63021 63022 63023 63024 63025 63026 63031 63046 63055
local Frango 78001 78002 78003 78004 78005 78006 78007 78008 78009 78010 78011 78012 78013 78014 78025 78026 78027 78032 78036 78038 78047 78048 78062 78066 78068 78070 78071 78072
local Laranja 68012 68013 68014 68015 68017 68018 68095 68097
local Leite_de_vaca 79001 79002 79031 79036 79037 79038
local Leite_em_pó 79006 79007 79008 79070 79117 79122
local Light_e_Diet 69070 69071 69079 69080 69081 69091 69092 69093 69094 69095 69096 69097 69098 69099 69100 69101 69102 69103 69104 69105 69106 69107 69108 69109 69110 69111 69112 69113 69114 69115 69116 69117 69118 69119 69120 69121 69122 69123 69124 69125 69126 69127 69129 69130 69131 69132 69133 69134 69135 69136 69137 69138 69139 69140 69141 69150 69151 69152 69158 69160 79039 79040 79041 79042 79051 79052 79053 79054 79055 79056 79057 79058 79059 79060 79061 79062 79063 79064 79065 79066 79067 79068 79069 79071 79072 79076 79077 79080 79086 79087 79089 79091 79092 79093 79094 79095 79096 79097 79103 79104 79105 79107 79108 79111 79114 79115 79116 79118
local Light_e_diet 80065 80066 80067 80068 80069 80070 80071 80072 80073 80074 80075 80076 80077 80078 80079 80080 80081 80082 80083 80084 80085 80086 80087 80088 80089 80090 80091 80092 80093 80094 80095 80096 80097 80098 80099 80100 80101 80102 80103 80104 80105 80108 80109 80112 80113 80114 80115 80117 80136 80137 80138 80142 80144 80145 80147 80148 80150 80151 80153
local Macarrão 65032 65033 65034 65048 65049 65063 65069 65078 65079 65080 65090 65100
local Maionese 70043 70104
local Mandioca 64006 64023 64024
local Massa_de_tomate 70047
local Maçã 68030 68086
local Orgânicos 63037 63038 63039 63040 63041 63043 63044 63045 63051 66029 78055 78056 78057 78058 78059 78064 78065 79043 79044 79045 79046 79047 79048 79049 79050 79073 79074
local Outras 65001 65002 65003 65004 65005 65006 65007 65008 65009 65011 65012 65013 65015 65016 65017 65018 65019 65020 65021 65022 65023 65024 65025 65026 65027 65028 65029 65030 65031 65035 65036 65037 65038 65039 65040 65041 65042 65043 65044 65045 65046 65047 65050 65051 65052 65053 65054 65055 65056 65057 65058 65059 65060 65061 65062 65064 65065 65066 65067 65068 65070 65071 65072 65073 65074 65076 65077 65081 65082 65083 65084 65085 65086 65087 65088 65089 65091 65092 65093 65094 65095 65096 65097 65098 65099 65101 65102 66017 66023 66026 69057 69064 69065 69075 69147 82020 82021 82022 82023 82024 82026 82027 82028 82029 82030 82031 82032 82033 82034 82036 82037 82038 82039 82044 82045 82047 82048 82050 82051 82053 82056 82059 82060 82061 82062 82063 82064 82065 82066 82080 82086 82101 82102 82103 82104 82105 82107 82108 82109 82130 82131 82132 82133 82135 82136 82137 82138 82142 82143 82144 82146 82148 82149 82151 82153 82154 82157 82158 82159 82160 82161 82162 82163 82164 82165 82166 82167 82177 82178 82179 82180 82181 82182 82183 82189 82190 82191 82192 82193 82194 82195 82199 82200 82210 82211
local Outras_bebidas_alcoólicas 82184 83003 83004 83005 83006 83007 83008 83009 83010 83011 83012 83013 83014 83015 83016 83017 83018 83019 83020 83021 83022 83023 83024 83025 83026 83027 83028 83029 83030 83031 83032 83034 83035 83036 83037 83038 83039 83040 83041 83042 83045 83046 83047 83048 83049 83052 83053
local Outras_frutas 68016 68019 68020 68021 68022 68023 68024 68025 68026 68027 68028 68029 68031 68032 68033 68034 68035 68036 68037 68038 68039 68040 68041 68042 68043 68044 68045 68046 68047 68048 68049 68050 68051 68052 68053 68054 68055 68056 68057 68058 68059 68060 68061 68062 68063 68064 68065 68066 68067 68068 68069 68070 68071 68072 68073 68074 68075 68076 68077 68078 68079 68080 68081 68082 68083 68084 68085 68087 68088 68089 68090 68092 68093 68094 68096 68099 68100 68101 68102 68103 68105 68106 68107 68108 68109 68110 68111 68112 68113 68114 68115 68116 68117 68118 68119 68120 68121 68122
local Outros 63004 63005 63006 63007 63008 63009 63010 63011 63020 63027 63028 63029 63030 63032 63035 63036 63042 63047 63048 63049 63057 64002 64003 64004 64005 64007 64008 64009 64010 64011 64013 64014 64015 64016 64017 64020 64022 64025 64026 64027 65075 66001 66002 66003 66004 66005 66006 66007 66008 66009 66010 66011 66012 66013 66014 66015 66016 66018 66019 66020 66021 66022 66024 66025 66027 66028 66030 66031 67002 67003 67004 67005 67006 67007 67008 67009 67010 67011 67012 67013 67014 67015 67016 67017 67018 67019 67020 67021 67022 67023 67024 67025 67026 67027 67028 67029 67030 67031 67032 67033 67034 67035 67036 67037 67038 67039 67040 67041 67042 67043 67044 67045 67046 67047 67048 67049 67050 67052 67053 67054 67055 67056 67058 67059 67060 67061 67062 67063 67064 67065 67066 67067 67068 67069 67070 67071 67072 67073 67074 67075 67076 67077 67080 67081 67082 67083 67084 67085 67086 67087 67088 67089 67090 67091 67092 67093 67094 67095 67096 67097 67098 67099 67100 67101 67102 67103 67104 67105 67106 67107 67108 67109 67110 67111 67112 67113 67114 67115 67116 67117 67118 67119 67120 67121 67122 67123 67124 67125 67126 67127 67128 67129 67131 67133 67134 67135 67136 67137 67138 67139 67140 67141 67142 67143 67144 67145 67146 67147 69003 69004 69005 69006 69007 69008 69009 69010 69011 69012 69013 69014 69015 69016 69017 69018 69019 69020 69021 69022 69023 69024 69025 69026 69027 69028 69029 69030 69031 69032 69033 69034 69035 69036 69037 69038 69039 69040 69041 69042 69043 69044 69045 69046 69047 69048 69049 69050 69051 69052 69053 69054 69055 69056 69058 69059 69060 69061 69062 69063 69066 69067 69068 69069 69072 69073 69074 69076 69077 69078 69082 69083 69084 69085 69088 69089 69090 69142 69143 69144 69145 69146 69148 69149 69153 69154 69155 69156 69157 69159 69161 69162 69163 69164 69165 69166 69167 69168 69169 69170 69171 69172 69173 69174 69175 69176 69177 70002 70003 70004 70005 70006 70007 70008 70009 70010 70011 70012 70013 70014 70015 70016 70017 70018 70019 70020 70021 70022 70023 70024 70025 70026 70027 70028 70029 70030 70031 70032 70033 70034 70035 70036 70037 70038 70039 70040 70041 70042 70044 70045 70046 70048 70049 70050 70051 70052 70053 70054 70055 70056 70057 70058 70059 70060 70061 70062 70063 70064 70065 70066 70067 70068 70069 70070 70071 70072 70073 70074 70075 70076 70077 70078 70079 70080 70081 70082 70083 70084 70085 70086 70087 70088 70089 70090 70091 70092 70093 70094 70095 70096 70097 70098 70099 70100 70101 70102 70103 70105 70106 70107 70108 70109 70111 70112 70113 70114 70115 70116 70117 70118 70119 70120 70121 70122 70123 70124 70125 70126 70127 70128 70129 70130 70131 70132 70133 70134 70135 70136 70137 70138 70139 70140 70141 70142 70143 70144 70145 70146 70147 70148 70149 70150 70151 71018 71019 71020 71021 71022 71023 71024 71025 71027 71028 71029 71030 71031 71032 71043 71054 71055 71056 71057 71058 71061 71062 71063 71066 71067 71069 71071 71072 71073 71074 71076 71077 71079 71080 71081 71086 71087 71088 71089 71090 71091 71092 71093 71094 71095 71096 71098 71099 71100 71101 71102 71103 71104 71107 71109 71110 71111 71123 71124 71129 71131 71132 71135 71137 71140 71141 71142 71143 71147 71149 71150 71151 78015 78016 78017 78018 78019 78020 78021 78022 78023 78024 78028 78029 78030 78031 78034 78035 78037 78039 78040 78041 78042 78043 78044 78045 78046 78049 78050 78051 78052 78053 78054 78060 78061 78063 78067 78069 79003 79004 79005 79009 79010 79011 79012 79013 79014 79015 79016 79023 79032 79035 79075 79085 79088 79119 79120 79121 79123 79125 80123 80127 80149 81011 81028 81030 81041 81049 81051 81055 81056 81060 81061 81081 84002 84004 84005 84006 84007 84008 84009 84010 84011 84012 84013 84014 84015 84016 84017 84018 84019 84020 84021 84022 84023 84024 84025 84026 84027 84028 84029 84030 84031 84032 84033 84034 84035 84036 84037 84038 84039 84040 84041 84042 84043 84044 84045
local Outros_panificados 80002 80003 80004 80005 80006 80007 80008 80009 80010 80011 80012 80013 80014 80015 80016 80017 80018 80019 80020 80021 80025 80026 80027 80028 80029 80030 80031 80032 80033 80034 80035 80036 80037 80038 80039 80040 80041 80042 80043 80044 80045 80046 80047 80050 80051 80055 80056 80057 80058 80059 80060 80061 80062 80063 80064 80106 80107 80110 80111 80119 80120 80121 80122 80124 80129 80130 80131 80132 80133 80134 80135 80143 80146 80152
local Ovo_de_galinha 78033
local Pescados_frescos 72001 72002 72003 72011 72012 72013 72021 72022 72023 72031 72032 72033 72039 72041 72042 72043 72049 72051 72052 72053 72061 72062 72063 72071 72072 72073 72081 72082 72083 72091 72092 72093 72101 72102 72103 72111 72112 72113 72121 72122 72123 72131 72132 72133 72141 72142 72143 72149 72151 72152 72153 72161 72162 72163 72169 72171 72172 72173 72181 72182 72183 72191 72192 72193 72201 72202 72203 72207 72211 72212 72213 72221 72222 72223 72231 72232 72233 72241 72242 72243 72249 72251 72252 72253 72261 72262 72263 72271 72272 72273 72279 72281 72282 72283 72291 72292 72293 72301 72302 72303 72311 72312 72313 72321 72322 72323 72331 72332 72333 72341 72342 72343 72351 72352 72353 72361 72362 72363 72371 72372 72373 72381 72382 72383 72391 72392 72393 72399 72401 72402 72403 72411 72412 72413 72421 72422 72423 72431 72432 72433 72441 72442 72443 72451 72452 72453 72461 72462 72463 72471 72472 72473 72481 72482 72483 72491 72492 72493 72501 72502 72503 72511 72512 72513 72521 72522 72523 72531 72532 72533 72541 72542 72543 72551 72552 72553 72561 72562 72563 72571 72572 72573 72581 72582 72583 72591 72592 72593 72601 72602 72611 72612 72621 72622 72631 72632 72641 72642 72651 72661 72662 72671 72672 72681 72682 72691 72692 72693 72711 72712 72713 72721 72722 72723 72731 72741 72742 72751 72752 72753 72761 72771 72781 72791 72802 72803 72811 72821 72822 72831 74001 74002 74003 74011 74012 74013 74021 74022 74023 74031 74032 74033 74041 74042 74043 74047 74049 74051 74052 74053 74061 74062 74063 74071 74072 74073 74081 74082 74083 74091 74092 74093 74101 74102 74103 74109 74111 74112 74113 74121 74122 74123 74131 74132 74133 74141 74142 74143 74151 74152 74153 74161 74162 74163 74171 74172 74173 74181 74182 74183 74191 74192 74193 74201 74202 74203 74211 74212 74213 74221 74222 74223 74227 74229 74231 74232 74233 74241 74242 74243 74251 74252 74253 74261 74262 74263 74271 74272 74273 74276 74281 74282 74283 74291 74292 74293 74301 74302 74303 74311 74312 74313 74321 74322 74323 74329 74331 74332 74333 74341 74342 74343 74349 74351 74352 74353 74361 74362 74363 74371 74372 74373 74381 74382 74383 74391 74392 74393 74401 74402 74403 74411 74412 74413 74421 74422 74423 74431 74432 74441 74442 74443 74451 74452 74453 74461 74462 74463 74471 74472 74473 74481 74482 74483 74491 74492 74493 74501 74502 74511 74512 74513 74519 74521 74531 74541 74551 74553 74561 74571 74581 74591 74601 74611 74621 76001 76002 76003 76007 76009
local Pão_francês 80001 80116
local Queijos 79017 79018 79019 79020 79021 79022 79024 79025 79026 79027 79028 79029 79030 79033 79034 79078 79079 79081 79082 79083 79084 79090 79098 79099 79100 79101 79102 79106 79109 79110 79112 79113 79124
local Refrigerantes 82001 82002 82003 82004 82005 82006 82009 82010 82011 82012 82013 82014 82017 82018 82035 82041 82042 82043 82046 82049 82054 82055 82057 82058 82067 82068 82069 82070 82071 82072 82073 82147 82155 82185 82186 82187 82188 82196 82197 82198
local Sal_refinado 70001 70110
local Tomate 67051 67079
local Óleo_de_soja 84003

* Grupos alimentares




end
